<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø²Ø§ÛŒØ¯Ù‡</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
  <style>
    body { font-family: sans-serif; direction: rtl; background: #f3f3f3; padding: 20px; }
    .box { background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
    .admin-only { border: 2px dashed red; margin-top: 20px; padding: 15px; }
    button { padding: 8px 15px; margin-top: 10px; }
    input { padding: 5px; margin: 5px 0; width: 100%; }
  </style>
</head>
<body>
  <h2>ğŸ¯ Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø²Ø§ÛŒØ¯Ù‡ Ù¾ÛŒØ´Ø±ÙØªÙ‡</h2>
  <button onclick="connectWallet()">Ø§ØªØµØ§Ù„ Ú©ÛŒÙ Ù¾ÙˆÙ„ ğŸ”Œ</button>
  <p id="wallet">Ú©ÛŒÙ Ù¾ÙˆÙ„: Ù…ØªØµÙ„ Ù†ÛŒØ³Øª</p>

  <div class="box">
    <p id="vipStatus">ğŸ”’ ÙˆØ¶Ø¹ÛŒØª VIP Ø´Ù…Ø§: Ø¨Ø±Ø±Ø³ÛŒ Ù†Ø´Ø¯Ù‡</p>
    <button onclick="buyVIP()">Ø®Ø±ÛŒØ¯ VIP (1 Ø¯Ù„Ø§Ø± BNB)</button>
  </div>

  <div class="box" id="auctionSection" style="display:none;">
    <h3>ğŸ”¥ Ù…Ø²Ø§ÛŒØ¯Ù‡â€ŒÙ‡Ø§</h3>

    <div>
      <h4>Ù…Ø²Ø§ÛŒØ¯Ù‡ 30 Ø±ÙˆØ²Ù‡</h4>
      <p>ğŸ Ø¬Ø§ÛŒØ²Ù‡: <span id="reward30">---</span> ØªÙˆÚ©Ù†</p>
      <p>â³ Ø²Ù…Ø§Ù† Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡: <span id="time30">--</span></p>
      <input type="number" id="bidAmount30" placeholder="Ù…Ù‚Ø¯Ø§Ø± BNB">
      <button onclick="bidAuction(1, 'bidAmount30')">Ø´Ø±Ú©Øª Ø¯Ø± Ù…Ø²Ø§ÛŒØ¯Ù‡</button>
      <ul id="list30"></ul>
    </div>

    <div style="margin-top:20px">
      <h4>Ù…Ø²Ø§ÛŒØ¯Ù‡ 60 Ø±ÙˆØ²Ù‡</h4>
      <p>ğŸ Ø¬Ø§ÛŒØ²Ù‡: <span id="reward60">---</span> ØªÙˆÚ©Ù†</p>
      <p>â³ Ø²Ù…Ø§Ù† Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡: <span id="time60">--</span></p>
      <input type="number" id="bidAmount60" placeholder="Ù…Ù‚Ø¯Ø§Ø± BNB">
      <button onclick="bidAuction(2, 'bidAmount60')">Ø´Ø±Ú©Øª Ø¯Ø± Ù…Ø²Ø§ÛŒØ¯Ù‡</button>
      <ul id="list60"></ul>
    </div>
  </div>

  <div class="admin-only" id="adminSection" style="display:none">
    <h3>ğŸ”§ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø¯ÛŒØ±</h3>
    <p>ØªØºÛŒÛŒØ± Ø¬Ø§ÛŒØ²Ù‡â€ŒÙ‡Ø§</p>
    <label>Ø¬Ø§ÛŒØ²Ù‡ 30 Ø±ÙˆØ²Ù‡:</label>
    <input id="setReward30" type="number">
    <label>Ø¬Ø§ÛŒØ²Ù‡ 60 Ø±ÙˆØ²Ù‡:</label>
    <input id="setReward60" type="number">
    <button onclick="updateRewards()">Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¬ÙˆØ§ÛŒØ²</button>
  </div>

<script>
const contractAddress = "0x81811cf143ee0db0f31508640b5ab164efbc353a";
const ownerAddress = "0xec54951C7d4619256Ea01C811fFdFa01A9925683"; // ØªØºÛŒÛŒØ± Ø¨Ø¯Ù‡ Ø¯Ø± ØµÙˆØ±Øª Ù†ÛŒØ§Ø²
let account, web3, contract;

const abi = [
  { "inputs":[],"name":"buyVIP","outputs":[],"stateMutability":"payable","type":"function" },
  { "inputs":[{"internalType":"uint8","name":"typeId","type":"uint8"}],"name":"bidAuction","outputs":[],"stateMutability":"payable","type":"function" },
  { "inputs":[],"name":"isVIP","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function" },
  { "inputs":[{"internalType":"uint8","name":"typeId","type":"uint8"}],"name":"getAuctionList","outputs":[{"internalType":"address[]","name":"addrs","type":"address[]"},{"internalType":"uint256[]","name":"amounts","type":"uint256[]"}],"stateMutability":"view","type":"function" },
  { "inputs":[],"name":"reward30","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function" },
  { "inputs":[],"name":"reward60","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function" },
  { "inputs":[{"internalType":"uint256","name":"r30","type":"uint256"},{"internalType":"uint256","name":"r60","type":"uint256"}],"name":"setRewards","outputs":[],"stateMutability":"nonpayable","type":"function" }
];

async function connectWallet() {
  if (!window.ethereum) return alert("Metamask Ù†ØµØ¨ Ù†ÛŒØ³Øª");
  web3 = new Web3(window.ethereum);
  await window.ethereum.request({ method: 'eth_requestAccounts' });
  const accounts = await web3.eth.getAccounts();
  account = accounts[0];
  contract = new web3.eth.Contract(abi, contractAddress);
  document.getElementById("wallet").innerText = "Ú©ÛŒÙ Ù¾ÙˆÙ„: " + account;
  checkVIP();
  checkAdmin();
  loadRewards();
  updateTimers();
  setInterval(updateTimers, 60000);
}

async function checkVIP() {
  const vip = await contract.methods.isVIP().call({ from: account });
  document.getElementById("vipStatus").innerText = vip ? "âœ… Ø´Ù…Ø§ VIP Ù‡Ø³ØªÛŒØ¯" : "ğŸ”’ Ø´Ù…Ø§ VIP Ù†ÛŒØ³ØªÛŒØ¯";
  document.getElementById("auctionSection").style.display = vip ? "block" : "none";
  if (vip) {
    loadParticipants(1);
    loadParticipants(2);
  }
}

async function buyVIP() {
  try {
    await contract.methods.buyVIP().send({ from: account, value: web3.utils.toWei("0.001", "ether") });
    alert("VIP ÙØ¹Ø§Ù„ Ø´Ø¯!");
    checkVIP();
  } catch (e) { alert("âŒ Ø®Ø·Ø§ Ø¯Ø± Ø®Ø±ÛŒØ¯ VIP"); }
}

async function bidAuction(id, inputId) {
  const val = document.getElementById(inputId).value;
  if (!val || parseFloat(val) <= 0) return alert("Ù…Ù‚Ø¯Ø§Ø± Ù†Ø§Ù…Ø¹ØªØ¨Ø±");
  try {
    await contract.methods.bidAuction(id).send({ from: account, value: web3.utils.toWei(val, "ether") });
    alert("âœ… Ø´Ø±Ú©Øª Ø¯Ø± Ù…Ø²Ø§ÛŒØ¯Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª");
    loadParticipants(id);
  } catch (e) { alert("âŒ Ø®Ø·Ø§ Ø¯Ø± Ù…Ø²Ø§ÛŒØ¯Ù‡"); }
}

async function loadParticipants(id) {
  const [addrs, amnts] = await contract.methods.getAuctionList(id).call();
  const list = document.getElementById(id === 1 ? "list30" : "list60");
  list.innerHTML = "";
  for (let i = 0; i < addrs.length; i++) {
    const bnb = web3.utils.fromWei(amnts[i], "ether");
    list.innerHTML += `<li>${addrs[i]} â¤ ${bnb} BNB</li>`;
  }
}

async function checkAdmin() {
  if (account.toLowerCase() === ownerAddress.toLowerCase()) {
    document.getElementById("adminSection").style.display = "block";
  }
}

async function loadRewards() {
  const r30 = await contract.methods.reward30().call();
  const r60 = await contract.methods.reward60().call();
  document.getElementById("reward30").innerText = r30;
  document.getElementById("reward60").innerText = r60;
  document.getElementById("setReward30").value = r30;
  document.getElementById("setReward60").value = r60;
}

async function updateRewards() {
  const r30 = document.getElementById("setReward30").value;
  const r60 = document.getElementById("setReward60").value;
  try {
    await contract.methods.setRewards(r30, r60).send({ from: account });
    alert("âœ… Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÙˆÙÙ‚");
    loadRewards();
  } catch (e) {
    alert("âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ");
  }
}

function updateTimers() {
  const now = new Date();
  const end30 = new Date("2025-08-30");
  const end60 = new Date("2025-09-30");
  document.getElementById("time30").innerText = diffText(end30 - now);
  document.getElementById("time60").innerText = diffText(end60 - now);
}

function diffText(ms) {
  if (ms < 0) return "Ù¾Ø§ÛŒØ§Ù† ÛŒØ§ÙØªÙ‡";
  const d = Math.floor(ms / (1000 * 60 * 60 * 24));
  const h = Math.floor((ms / (1000 * 60 * 60)) % 24);
  return `${d} Ø±ÙˆØ² Ùˆ ${h} Ø³Ø§Ø¹Øª`;
}
</script>
</body>
</html>
