<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>Legend Token Platform</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
  <style>
    body { font-family: sans-serif; background: #111; color: #fff; padding: 20px; direction: rtl; }
    .section { border: 1px solid #444; padding: 20px; margin-bottom: 20px; border-radius: 10px; background: #222; }
    button { padding: 10px 15px; margin-top: 10px; background: #28a745; color: #fff; border: none; border-radius: 6px; cursor: pointer; }
    input, select { padding: 8px; margin-top: 10px; width: 100%; border-radius: 6px; }
    h2 { color: #ffd700; }
  </style>
</head>
<body>

  <!-- معرفی توکن -->
  <div class="section">
    <h2>معرفی توکن LEGEND</h2>
    <p>توکن LEGEND با قرارداد: <code>0x75DaF5e1401a7fE3F1c31a364b62a41Cb9eCf842</code></p>
    <p>حداکثر عرضه: 1,000,000,000</p>
    <p>قابل معامله در شبکه BSC با قابلیت شرط بندی و خرید/فروش درون سایتی</p>
  </div>

  <!-- اتصال کیف پول -->
  <div class="section">
    <h2>اتصال کیف پول</h2>
    <button onclick="connectWallet()">اتصال متامسک</button>
    <p id="wallet-status">کیف پول متصل نشده</p>
  </div>

  <!-- خرید توکن -->
  <div class="section">
    <h2>خرید توکن LEGEND</h2>
    <input type="number" id="buyAmount" placeholder="مقدار خرید (LEGEND)">
    <button onclick="buyToken()">خرید با کسر ۱٪ کارمزد</button>
  </div>

  <!-- شرط بندی -->
  <div class="section">
    <h2>بازی روی رمزارزها</h2>
    <label>انتخاب رمزارز:</label>
    <select id="tokenSelect">
      <option value="bitcoin">Bitcoin</option>
      <option value="ethereum">Ethereum</option>
      <option value="bnb">BNB</option>
      <option value="legend">LEGEND</option>
    </select>
    <input type="number" id="betAmount" placeholder="مقدار توکن LEGEND برای بازی (حداقل 10)">
    <label>پیش بینی شما:</label>
    <select id="betDirection">
      <option value="up">بالا می‌رود</option>
      <option value="down">پایین می‌آید</option>
    </select>
    <button onclick="placeBet()">ثبت بازی</button>
    <p id="betResult"></p>
  </div>

  <!-- لیست افراد برتر -->
  <div class="section">
    <h2>رتبه‌بندی کاربران</h2>
    <ul id="leaderboard">
      <li>کاربر A - امتیاز: 120</li>
      <li>کاربر B - امتیاز: 110</li>
      <li>کاربر C - امتیاز: 95</li>
    </ul>
  </div>

  <!-- اسکریپت اصلی -->
  <script>
    const tokenAddress = "0x75DaF5e1401a7fE3F1c31a364b62a41Cb9eCf842";
    const ownerWallet = "0xYourWalletAddressHere";
    const tokenABI = [
      {
        "inputs": [
          { "internalType": "address", "name": "recipient", "type": "address" },
          { "internalType": "uint256", "name": "amount", "type": "uint256" }
        ],
        "name": "transfer",
        "outputs": [{ "internalType": "bool", "name": "", "type": "bool" }],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          { "internalType": "address", "name": "sender", "type": "address" },
          { "internalType": "address", "name": "recipient", "type": "address" },
          { "internalType": "uint256", "name": "amount", "type": "uint256" }
        ],
        "name": "transferFrom",
        "outputs": [{ "internalType": "bool", "name": "", "type": "bool" }],
        "stateMutability": "nonpayable",
        "type": "function"
      }
    ];

    let web3;
    let account;

    async function connectWallet() {
      if (window.ethereum) {
        web3 = new Web3(window.ethereum);
        await window.ethereum.request({ method: 'eth_requestAccounts' });
        const accounts = await web3.eth.getAccounts();
        account = accounts[0];
        document.getElementById("wallet-status").innerText = متصل شد: ${account};
      } else {
        alert("لطفاً MetaMask را نصب کنید.");
      }
    }

    async function buyToken() {
      const amount = document.getElementById("buyAmount").value;
      if (!amount || amount <= 0) return alert("مقدار معتبر وارد کنید");

      const contract = new web3.eth.Contract(tokenABI, tokenAddress);
      const decimals = 18;
      const fullAmount = BigInt(amount * 10 ** decimals);
      const fee = fullAmount / 100n;
      const finalAmount = fullAmount - fee;

      try {
        await contract.methods.transferFrom(account, ownerWallet, fee.toString()).send({ from: account });
        await contract.methods.transferFrom(account, account, finalAmount.toString()).send({ from: account });
        alert("خرید موفقیت‌آمیز بود.");
      } catch (err) {
        console.error(err);
        alert("تراکنش ناموفق بود.");
      }
    }

    function placeBet() {
      const amount = Number(document.getElementById("betAmount").value);
      const direction = document.getElementById("betDirection").value;
      if (amount < 10) return alert("حداقل مقدار برای بازی بندی 10 توکن است");

      const result = Math.random() < 0.5 ? "up" : "down";
      const isWin = result === direction;

      setTimeout(() => {
        if (isWin) {
          document.getElementById("betResult").innerText = "شما برنده شدید! امتیاز دریافت شد.";
        } else {
          document.getElementById("betResult").innerText = "باختید! توکن‌ها کسر شد.";
        }
      }, 60000);
    }
  </script>

</body>
</html>
